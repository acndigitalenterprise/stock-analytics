# Nginx Configuration Fix for Trailing Slash 403 Errors
# Add these location blocks to your Nginx site configuration

# =================================
# TRAILING SLASH REDIRECTS (Nginx Level)  
# =================================

# Exact match redirects (highest priority)
location = /dashboard/ {
    return 301 /dashboard;
}

location = /requests/ {
    return 301 /requests;
}

location = /settings/ {
    return 301 /settings;
}

location = /market/ {
    return 301 /market;
}

location = /users/ {
    return 301 /users;
}

location = /signin/ {
    return 301 /signin;
}

location = /signup/ {
    return 301 /signup;
}

# =================================
# COMPLETE SITE BLOCK EXAMPLE
# =================================

server {
    listen 443 ssl http2;
    server_name tickerai.app;
    root /home/forge/tickerai.app/public;

    index index.html index.htm index.php;

    charset utf-8;

    # TRAILING SLASH REDIRECTS - ADD THESE BEFORE OTHER LOCATIONS
    location = /dashboard/ { return 301 /dashboard; }
    location = /requests/ { return 301 /requests; }
    location = /settings/ { return 301 /settings; }
    location = /market/ { return 301 /market; }
    location = /users/ { return 301 /users; }
    location = /signin/ { return 301 /signin; }
    location = /signup/ { return 301 /signup; }

    # Default Laravel location block
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location = /favicon.ico { access_log off; log_not_found off; }
    location = /robots.txt  { access_log off; log_not_found off; }

    access_log off;
    error_log  /var/log/nginx/tickerai.app-error.log error;

    error_page 404 /index.php;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
        fastcgi_hide_header X-Powered-By;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}